var Keywatch=function(e){"use strict";function t(e){return e.slice(-1)[0]}function n(e,t){return-1!==e.indexOf(t)}function r(e){return"string"==typeof e}function o(e){return!Array.isArray(e)&&Object.prototype.isPrototypeOf(e)}let s=!1;const i=[];let u=[],c=1;const a=Object.freeze(["Shift","Control","Alt","Meta"]),l=Object.freeze(["up","down"]),h=Object.freeze(["INPUT","TEXTAREA","SELECT"]),f=navigator.platform.includes("Mac"),y=navigator.platform.includes("Win");function p(){s&&(document.addEventListener("keyup",d),document.addEventListener("keydown",d),s=!1)}function d(e){const r=u.slice(0);if("keyup"===e.type){const n=t(r);n&&"keydown"===n.type&&n.code===e.code&&r.pop()}r.push(e);let o=!1;for(const t of i){if(e.defaultPrevented)break;if(t.matches(r)&&(o=!0,t.reaction(e,t.sequence),t.preventsDefault)){e.preventDefault();break}}if(o)u=[];else{for(function(e){return n(a,e.key)}(e)&&r.pop();r.length>c;)r.shift();u=r}}function m(e,t,n=null){null===n&&"function"!=typeof t&&(n=t,t=null);const r=w(e,t).map((e=>{try{return{dispose:g(e.sequence,e.handler,n),sequence:e.sequence,handler:e.handler,ref:n}}catch(e){return null}})).filter((e=>null!==e));return()=>{r.forEach(((e,t)=>{try{e.dispose()}catch(e){console.warn("failed to unwatch",t,e)}}))}}function w(e,t=null){if("function"==typeof e)return w(e(),t);if(o(e))return w(k(e,""));if(r(e))return w([{keys:e,handler:t}]);if(!Array.isArray(e))throw new Error("sequence should be defined as an array");return null!=t?w([{keys:e,handler:t}]):e.map(((t,n)=>{const r=t.sequence||t.keys||t.key;try{return{sequence:E.parse(r),handler:t.handler}}catch(r){return console.warn("Dropping invalid sequence from",t,n,e,t.handler,r),null}})).filter((e=>null!==e))}function k(e,t){return Object.keys(e).flatMap((n=>{const r=e[n];if("function"==typeof r)return[{keys:t+n,handler:r}];if(o(r))return k(r,t+n+" ");throw new Error(`Expected value of key '${n}' to be a function, got '${typeof r}'`)}))}function g(e,t,n=null){const r=new b(e,t,n);return r.keyCount>c&&(c=r.keyCount,c>10&&console.warn(`increasing MaxKeptKeys to ${c} for sequence`,r.sequence)),i.unshift(r),s||s||(s=!0,document.addEventListener("keyup",d),document.addEventListener("keydown",d)),console.log("watching",r.sequence+"",r),()=>function(e){for(let t=i.length-1;t>=0;t--)i[t]===e&&i.splice(t,1);C()}(r)}function K(e){for(let t=i.length-1;t>=0;t--)i[t].ref===e&&i.splice(t,1);C()}function C(){c=Math.max(1,...i.map((e=>e.keyCount))),0===i.length&&s&&p()}const v={"↑":"ArrowUp","↓":"ArrowDown","←":"ArrowLeft","→":"ArrowRight","⎋":"Escape","⇥":"Tab","⏎":"Enter","⌤":"NumpadEnter","⇞":"PageUp","⇟":"PageDown","↖︎":"Home","↘︎":"End","⌫":"Backspace","⌦":"Delete","␣":"Space"};class q{constructor(e,t=!0,n=!1,r=!1,o=!1,s=!1,i=null,u="up"){this.code=e,this.isCode=t,this.shiftKey=n,this.ctrlKey=r,this.altKey=o,this.metaKey=s,this.inInput=i,this.type=(u.startsWith("key")?u:"key"+u).toLowerCase()}matches(e){if(e.type!==this.type)return!1;if(!this.inInput&&n(h,e.target.tagName))return!1;if(e.shiftKey!==this.shiftKey)return!1;if(e.ctrlKey!==this.ctrlKey)return!1;if(e.altKey!==this.altKey)return!1;if(e.metaKey!==this.metaKey)return!1;const t=this.isCode?e.code:e.key;return this.code===t}get outputType(){return this.type.substring(3).split("").map(((e,t)=>0===t?e.toUpperCase():e)).join("")}toString(e=!1){return e?[!this.inInput&&":",this.metaKey&&(f?"⌘":"@"),this.ctrlKey&&"^",this.altKey&&(f?"⌥":"#"),this.shiftKey&&"+",this.code,"Up"===this.outputType?"":this.outputType].filter((e=>e)).join(""):[!this.inInput&&"NoInput",this.metaKey&&(f?"Command ":"Meta"),this.ctrlKey&&"Control",this.altKey&&"Alt",this.shiftKey&&"Shift",this.code,this.outputType].filter((e=>e)).join(" ")}static parse(e){if(e instanceof q)return e;if(0===e.trim().length)throw new Error("Key definition must not be empty!");const r=(o=e.replace(/:/," NoInput ").replace(/([@⌘]|Command)/i," Meta ").replace(/(\^|ctrl)/," Control ").replace(/([#⌥]+)/," Alt ").replace(/[+⇧]+/," Shift "),Object.keys(v).reduce(((e,t)=>e.replace(t," "+v[t]+" ")),o)).replace(/_+(\w+)/g,((e,t)=>" "+t)).split(/\s+/).map((e=>e.trim())).filter((e=>e.length>0));var o;n(l,t(r).toLowerCase())||r.push(n(r,"Meta")||n(r,"Control")?"down":"up");const s=t(r).toLowerCase(),i=r.slice(-2)[0],u=i.length>1,c=r.slice(0,-2).map((e=>e.toLowerCase()));return new q(i,u,n(c,"shift"),n(c,"control"),n(c,"alt"),n(c,"meta"),!n(c,"noinput"),t(r),s)}}class E{constructor(e,t=!1,n=null){if(e.length<1)throw new Error("A KeySequence must contain at least one key, none provided!");this.keys=e,this.preventDefault=t,this.onSystem=n}get keyCount(){return this.keys.length}matches(e){if(e.length<this.keyCount)return!1;if(!function(e){switch((e||"").trim()){case"":return!0;case"mac":return f;case"win":return y;default:return!1}}(this.onSystem))return!1;const t=e.slice(-this.keyCount);for(let e=0,n=this.keyCount;e<n;e++){const n=this.keys[e],r=t[e];if(!n.matches(r))return!1}return!0}toString(e=!1){return this.keys.map((t=>t.toString(e))).join(", ")}static parse(e){if(e instanceof E)return e;let t=e,n=null,o=!1;if(r(t)){const e=/(.*)\bon(?:ly)-?(win|mac|u?nix)\s+(.+)/i.exec(t);null!==e&&(n=e[2].toLowerCase(),t=(e[1]+e[3]).trim());const r=/(.*)(^!|no-?default\s+|prevent\s+)(.+)/i.exec(t);null!==r&&(o=!0,t=(r[1]+r[3]).trim())}const s=(Array.isArray(t)?t:t.split(/\s*,\s*/)).map(((t,n)=>{try{return q.parse(t)}catch(r){throw new Error(`Unable to parse key definition #${n} "${t}" in sequence "${e}: ${r.message}"`)}}));return new E(s,o,n)}}class b{constructor(e,t,n){this.sequence=E.parse(e),this.reaction=t,this.ref=n}get keyCount(){return this.sequence.keyCount}get preventsDefault(){return this.sequence.preventDefault}matches(e){return this.sequence.matches(e)}hasRef(e){return this.ref===e}toString(){return this.sequence.toString()}}function A(e,t,n){if(t instanceof Promise)return t.then((t=>A(e,t)));const r=w(t).flatMap((t=>{try{return[g(t.sequence,t.handler.bind(e),e)]}catch(e){return console.error("Failed to watch %O",t,err),[]}}));return()=>r.forEach(((e,t)=>{try{e()}catch(n){console.warn("failed to dispose",e,t,n)}}))}return window.module&&window.module.hot&&window.module.hot.addDisposeHandler&&window.module.hot.addDisposeHandler(p),e.Key=q,e.KeySequence=E,e.KeySequenceListener=b,e.Mixin=function(e=null,t={}){return{mounted(){if(e){if(r(e)){let t=Promise.resolve((()=>{}));const n=e=>{t.then((n=>{try{n()}catch(e){console.warn("failed to unwatch",this,e)}e?(t=A(this,e),t instanceof Promise||(t=Promise.resolve(t))):t=Promise.resolve((()=>{}))}))};return n(this[e]),void this.$watch(e,n)}A(this,e)}},beforeDestroy(){K(this)},methods:{$watchKeys(e,t){return m(e,t,this)}}}},e.formatKeyEvent=function(e,t=!1,n=!1){let r="";e.shiftKey&&(r+=["Shift ",n?"⇧":"+"][+t]),e.ctrlKey&&(r+=["Control ","^"][+t]),e.altKey&&(r+=["Alt ",n?"⌥":"#"][+t]),e.metaKey&&(r+=[n?"Meta ":"Command ",n?"⌘":"@"][+t]);const o=(s=e.code,Object.keys(v).find((e=>v[e]===s)));var s;return t&&o?r+=o:t&&e.code.toLowerCase()===("key"+e.key).toLowerCase()?r+=e.key:r+=e.code,"keydown"===e.type&&(r+=" Down"),"keypress"===e.type&&(r+=" Press"),r},e.of=function(e){return{watch:(t,n)=>m(t,n,e),unwatch(){K(e)}}},e.unfoldKeyDefinition=w,e.unwatchAll=K,e.watch=m,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
