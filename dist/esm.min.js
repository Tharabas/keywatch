function e(e){return e.slice(-1)[0]}function t(e,t){return-1!==e.indexOf(t)}function n(e){return"string"==typeof e}function r(e){return!Array.isArray(e)&&Object.prototype.isPrototypeOf(e)}let o=!1;const s=[];let i=[],u=1;const c=Object.freeze(["Shift","Control","Alt","Meta"]),a=Object.freeze(["up","down"]),l=Object.freeze(["INPUT","TEXTAREA","SELECT"]),h=navigator.platform.includes("Mac"),f=navigator.platform.includes("Win");function y(e,t=!1,n=!1){let r="";e.shiftKey&&(r+=["Shift ",n?"⇧":"+"][+t]),e.ctrlKey&&(r+=["Control ","^"][+t]),e.altKey&&(r+=["Alt ",n?"⌥":"#"][+t]),e.metaKey&&(r+=[n?"Meta ":"Command ",n?"⌘":"@"][+t]);const o=(s=e.code,Object.keys(E).find((e=>E[e]===s)));var s;return t&&o?r+=o:t&&e.code.toLowerCase()===("key"+e.key).toLowerCase()?r+=e.key:r+=e.code,"keydown"===e.type&&(r+=" Down"),"keypress"===e.type&&(r+=" Press"),r}function p(){o&&(document.addEventListener("keyup",d),document.addEventListener("keydown",d),o=!1)}function d(n){const r=i.slice(0);if("keyup"===n.type){const t=e(r);t&&"keydown"===t.type&&t.code===n.code&&r.pop()}r.push(n);let o=!1;for(const e of s){if(n.defaultPrevented)break;if(e.matches(r)&&(o=!0,e.reaction(n,e.sequence),e.preventsDefault)){n.preventDefault();break}}if(o)i=[];else{for(function(e){return t(c,e.key)}(n)&&r.pop();r.length>u;)r.shift();i=r}}function m(e,t,n=null){null===n&&"function"!=typeof t&&(n=t,t=null);const r=w(e,t).map((e=>{try{return{dispose:g(e.sequence,e.handler,n),sequence:e.sequence,handler:e.handler,ref:n}}catch(e){return null}})).filter((e=>null!==e));return()=>{r.forEach(((e,t)=>{try{e.dispose()}catch(e){console.warn("failed to unwatch",t,e)}}))}}function w(e,t=null){if("function"==typeof e)return w(e(),t);if(r(e))return w(k(e,""));if(n(e))return w([{keys:e,handler:t}]);if(!Array.isArray(e))throw new Error("sequence should be defined as an array");return null!=t?w([{keys:e,handler:t}]):e.map(((t,n)=>{const r=t.sequence||t.keys||t.key;try{return{sequence:b.parse(r),handler:t.handler}}catch(r){return console.warn("Dropping invalid sequence from",t,n,e,t.handler,r),null}})).filter((e=>null!==e))}function k(e,t){return Object.keys(e).flatMap((n=>{const o=e[n];if("function"==typeof o)return[{keys:t+n,handler:o}];if(r(o))return k(o,t+n+" ");throw new Error(`Expected value of key '${n}' to be a function, got '${typeof o}'`)}))}function g(e,t,n=null){const r=new A(e,t,n);return r.keyCount>u&&(u=r.keyCount,u>10&&console.warn(`increasing MaxKeptKeys to ${u} for sequence`,r.sequence)),s.unshift(r),o||o||(o=!0,document.addEventListener("keyup",d),document.addEventListener("keydown",d)),console.log("watching",r.sequence+"",r),()=>function(e){for(let t=s.length-1;t>=0;t--)s[t]===e&&s.splice(t,1);v()}(r)}function K(e){return{watch:(t,n)=>m(t,n,e),unwatch(){C(e)}}}function C(e){for(let t=s.length-1;t>=0;t--)s[t].ref===e&&s.splice(t,1);v()}function v(){u=Math.max(1,...s.map((e=>e.keyCount))),0===s.length&&o&&p()}const E={"↑":"ArrowUp","↓":"ArrowDown","←":"ArrowLeft","→":"ArrowRight","⎋":"Escape","⇥":"Tab","⏎":"Enter","⌤":"NumpadEnter","⇞":"PageUp","⇟":"PageDown","↖︎":"Home","↘︎":"End","⌫":"Backspace","⌦":"Delete","␣":"Space"};class q{constructor(e,t=!0,n=!1,r=!1,o=!1,s=!1,i=null,u="up"){this.code=e,this.isCode=t,this.shiftKey=n,this.ctrlKey=r,this.altKey=o,this.metaKey=s,this.inInput=i,this.type=(u.startsWith("key")?u:"key"+u).toLowerCase()}matches(e){if(e.type!==this.type)return!1;if(!this.inInput&&t(l,e.target.tagName))return!1;if(e.shiftKey!==this.shiftKey)return!1;if(e.ctrlKey!==this.ctrlKey)return!1;if(e.altKey!==this.altKey)return!1;if(e.metaKey!==this.metaKey)return!1;const n=this.isCode?e.code:e.key;return this.code===n}get outputType(){return this.type.substring(3).split("").map(((e,t)=>0===t?e.toUpperCase():e)).join("")}toString(e=!1){return e?[!this.inInput&&":",this.metaKey&&(h?"⌘":"@"),this.ctrlKey&&"^",this.altKey&&(h?"⌥":"#"),this.shiftKey&&"+",this.code,"Up"===this.outputType?"":this.outputType].filter((e=>e)).join(""):[!this.inInput&&"NoInput",this.metaKey&&(h?"Command ":"Meta"),this.ctrlKey&&"Control",this.altKey&&"Alt",this.shiftKey&&"Shift",this.code,this.outputType].filter((e=>e)).join(" ")}static parse(n){if(n instanceof q)return n;if(0===n.trim().length)throw new Error("Key definition must not be empty!");const r=(o=n.replace(/:/," NoInput ").replace(/([@⌘]|Command)/i," Meta ").replace(/(\^|ctrl)/," Control ").replace(/([#⌥]+)/," Alt ").replace(/[+⇧]+/," Shift "),Object.keys(E).reduce(((e,t)=>e.replace(t," "+E[t]+" ")),o)).replace(/_+(\w+)/g,((e,t)=>" "+t)).split(/\s+/).map((e=>e.trim())).filter((e=>e.length>0));var o;t(a,e(r).toLowerCase())||r.push(t(r,"Meta")||t(r,"Control")?"down":"up");const s=e(r).toLowerCase(),i=r.slice(-2)[0],u=i.length>1,c=r.slice(0,-2).map((e=>e.toLowerCase()));return new q(i,u,t(c,"shift"),t(c,"control"),t(c,"alt"),t(c,"meta"),!t(c,"noinput"),e(r),s)}}class b{constructor(e,t=!1,n=null){if(e.length<1)throw new Error("A KeySequence must contain at least one key, none provided!");this.keys=e,this.preventDefault=t,this.onSystem=n}get keyCount(){return this.keys.length}matches(e){if(e.length<this.keyCount)return!1;if(!function(e){switch((e||"").trim()){case"":return!0;case"mac":return h;case"win":return f;default:return!1}}(this.onSystem))return!1;const t=e.slice(-this.keyCount);for(let e=0,n=this.keyCount;e<n;e++){const n=this.keys[e],r=t[e];if(!n.matches(r))return!1}return!0}toString(e=!1){return this.keys.map((t=>t.toString(e))).join(", ")}static parse(e){if(e instanceof b)return e;let t=e,r=null,o=!1;if(n(t)){const e=/(.*)\bon(?:ly)-?(win|mac|u?nix)\s+(.+)/i.exec(t);null!==e&&(r=e[2].toLowerCase(),t=(e[1]+e[3]).trim());const n=/(.*)(^!|no-?default\s+|prevent\s+)(.+)/i.exec(t);null!==n&&(o=!0,t=(n[1]+n[3]).trim())}const s=(Array.isArray(t)?t:t.split(/\s*,\s*/)).map(((t,n)=>{try{return q.parse(t)}catch(r){throw new Error(`Unable to parse key definition #${n} "${t}" in sequence "${e}: ${r.message}"`)}}));return new b(s,o,r)}}class A{constructor(e,t,n){this.sequence=b.parse(e),this.reaction=t,this.ref=n}get keyCount(){return this.sequence.keyCount}get preventsDefault(){return this.sequence.preventDefault}matches(e){return this.sequence.matches(e)}hasRef(e){return this.ref===e}toString(){return this.sequence.toString()}}function S(e,t,n){if(t instanceof Promise)return t.then((t=>S(e,t)));const r=w(t).flatMap((t=>{try{return[g(t.sequence,t.handler.bind(e),e)]}catch(e){return console.error("Failed to watch %O",t,err),[]}}));return()=>r.forEach(((e,t)=>{try{e()}catch(n){console.warn("failed to dispose",e,t,n)}}))}function D(e=null,t={}){return{mounted(){if(e){if(n(e)){let t=Promise.resolve((()=>{}));const n=e=>{t.then((n=>{try{n()}catch(e){console.warn("failed to unwatch",this,e)}e?(t=S(this,e),t instanceof Promise||(t=Promise.resolve(t))):t=Promise.resolve((()=>{}))}))};return n(this[e]),void this.$watch(e,n)}S(this,e)}},beforeDestroy(){C(this)},methods:{$watchKeys(e,t){return m(e,t,this)}}}}window.module&&window.module.hot&&window.module.hot.addDisposeHandler&&window.module.hot.addDisposeHandler(p);export{q as Key,b as KeySequence,A as KeySequenceListener,D as Mixin,y as formatKeyEvent,K as of,w as unfoldKeyDefinition,C as unwatchAll,m as watch};
