function t(t){return t.slice(-1)[0]}function e(t,e){return-1!==t.indexOf(e)}function n(t){return"string"==typeof t}let r=!1;const s=[];let i=[],o=1;const c=Object.freeze(["Shift","Control","Alt","Meta"]),u=Object.freeze(["up","down"]),a=Object.freeze(["INPUT","TEXTAREA","SELECT"]),h=-1!==navigator.userAgent.indexOf("Macintosh");function l(){r&&(document.addEventListener("keyup",f),document.addEventListener("keydown",f),r=!1)}function f(n){const r=i.slice(0);if("keyup"===n.type){const e=t(r);e&&"keydown"===e.type&&e.code===n.code&&r.pop()}r.push(n);let u=!1;for(const t of s){if(n.defaultPrevented)break;if(t.matches(r)&&(u=!0,t.reaction(n,t.sequence),t.preventsDefault)){n.preventDefault();break}}if(u)i=[];else{for(function(t){return e(c,t.key)}(n)&&r.pop();r.length>o;)r.shift();i=r}}function p(t,e,n=null){const i=new K(t,e,n);return i.keyCount>o&&(o=i.keyCount,o>10&&console.warn(`increasing MaxKeptKeys to ${o} for sequence`,i.sequence)),s.unshift(i),r||r||(r=!0,document.addEventListener("keyup",f),document.addEventListener("keydown",f)),()=>y(i)}function y(t){for(let e=s.length-1;e>=0;e--)s[e]===t&&s.splice(e,1);w()}function d(t){return{watch:(e,n)=>p(e,n,t),unwatch(e){void 0===e?m(t):y(e)}}}function m(t){for(let e=s.length-1;e>=0;e--)s[e].ref===t&&s.splice(e,1);w()}function w(){o=Math.max(1,...s.map((t=>t.keyCount))),0===s.length&&r&&l()}class k{constructor(t,e=!0,n=!1,r=!1,s=!1,i=!1,o=null,c="up"){this.code=t,this.isCode=e,this.shiftKey=n,this.ctrlKey=r,this.altKey=s,this.metaKey=i,this.inInput=o,this.type=(c.startsWith("key")?c:"key"+c).toLowerCase()}matches(t){if(t.type!==this.type)return!1;if(!this.inInput&&e(a,t.target.tagName))return!1;if(t.shiftKey!==this.shiftKey)return!1;if(t.ctrlKey!==this.ctrlKey)return!1;if(t.altKey!==this.altKey)return!1;if(t.metaKey!==this.metaKey)return!1;const n=this.isCode?t.code:t.key;return this.code===n}get outputType(){return this.type.substring(3).split("").map(((t,e)=>0===e?t.toUpperCase():t)).join("")}toString(t=!1){return t?[!this.inInput&&":",this.metaKey&&(h?"⌘":"@"),this.ctrlKey&&"^",this.altKey&&(h?"⌥":"#"),this.shiftKey&&"+",this.code,"Up"===this.outputType?"":this.outputType].filter((t=>t)).join(""):[!this.inInput&&"NoInput",this.metaKey&&(h?"Command ":"Meta"),this.ctrlKey&&"Control",this.altKey&&"Alt",this.shiftKey&&"Shift",this.code,this.outputType].filter((t=>t)).join(" ")}static parse(n){if(n instanceof k)return n;const r=n.replace(/:/," NoInput ").replace(/([@⌘]|Command)/i," Meta ").replace(/(\^|ctrl)/," Control ").replace(/([#⌥]+)/," Alt ").replace(/[+⇧]+/," Shift ").replace(/⎋/," Escape ").replace(/⏎/," Return ").replace(/↑/," Up ").replace(/↓/," Down ").replace(/_+(\w+)/g,((t,e)=>" "+e)).split(/\s+/).map((t=>t.trim())).filter((t=>t.length>0));e(u,t(r).toLowerCase())||r.push(e(r,"Meta")||e(r,"Control")?"down":"up");const s=t(r).toLowerCase(),i=r.slice(-2)[0],o=i.length>1,c=r.slice(0,-2).map((t=>t.toLowerCase()));return new k(i,o,e(c,"shift"),e(c,"control"),e(c,"alt"),e(c,"meta"),!e(c,"noinput"),t(r),s)}}class g{constructor(t,e=!1){if(t.length<1)throw new Error("A KeySequence must contain at least one key, none provided!");this.keys=t,this.preventDefault=e}get keyCount(){return this.keys.length}matches(t){if(t.length<this.keyCount)return!1;const e=t.slice(-this.keyCount);for(let t=0,n=this.keyCount;t<n;t++){const n=this.keys[t],r=e[t];if(!n.matches(r))return!1}return!0}toString(t=!1){return this.keys.map((e=>e.toString(t))).join(", ")}static parse(t){if(t instanceof g)return t;let e=!1;const r=/^(!|no-?default |prevent )(.+)/i;n(t)&&r.test(t)&&(r.exec(t)[2],e=!0);const s=(Array.isArray(t)?t:t.split(/\s*,\s*/)).map(((e,n)=>{try{return k.parse(e)}catch(r){throw new Error(`Unable to parse key definition #${n} "${e}" in sequence "${t}"`)}}));return new g(s,e)}}class K{constructor(t,e,n){this.sequence=g.parse(t),this.reaction=e,this.ref=n}get keyCount(){return this.sequence.keyCount}get preventsDefault(){return this.sequence.preventDefault}matches(t){return this.sequence.matches(t)}hasRef(t){return this.ref===t}toString(){return this.sequence.toString()}}function C(t,e,r){if(t instanceof Promise)return t.then((e=>C(t,e)));var s;if(s=e,!Array.isArray(s)&&Object.prototype.isPrototypeOf(s)&&(e=Object.keys(e).map((t=>({key:t,handler:e[t]})))),!Array.isArray(e))throw new Error("shortcuts should be defined as an array!");const i=[];for(const r of e){const e=r.keys||r.key;let s=r.handler;if(n(s)){if(!this.hasOwnProperty(s)){console.warn("skipped binding %O to undefined method '%O' on %O",e,s,t);continue}s=t[s]}const o=p(e,s.bind(t),t);i.push(o)}return()=>i.forEach(((t,e)=>{try{t()}catch(n){console.warn("failed to dispose",t,e,n)}}))}function v(t=null,e={}){return{mounted(){if(t){if(n(t)){let e=null;const n=t=>{if(e)try{e()}catch(t){console.warn("failed to unwatch",this,t)}e=t?C(this,t):null};return n(this[t]),void this.$watch(t,n)}C(this,"function"==typeof t?t.call(this):t)}},beforeDestroy(){m(this)},methods:{$watchKeys(t,e){return p(t,e,this)}}}}window.module&&window.module.hot&&window.module.hot.addDisposeHandler&&window.module.hot.addDisposeHandler(l);export{v as Mixin,d as of,y as unwatch,m as unwatchAll,p as watch};
